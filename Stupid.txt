CH∆Ø∆†NG 1.  T·ªîNG QUAN V·ªÄ B·∫¢O M·∫¨T TRONG H·ªÜ TH·ªêNG NH√öNG V√Ä IOT. ƒê·ªÄ XU·∫§T BOOTLOADER B·∫¢O M·∫¨T CHO QU√Å TR√åNH C·∫¨P NH·∫¨T PH·∫¶N M·ªÄM T·ª™ XA 
1.1 T·ªïng quan h·ªá th·ªëng nh√∫ng, IoT v√† nhu c·∫ßu c·∫≠p nh·∫≠t ph·∫ßn m·ªÅm t·ª´ xa
1.1.1 Gi·ªõi thi·ªáu v·ªÅ h·ªá th·ªëng nh√∫ng v√† IoT
1.1.2 Th·ª±c tr·∫°ng √°p d·ª•ng c·∫≠p nh·∫≠t ph·∫ßn m·ªÅm t·ª´ xa

1.2 C√°c th√°ch th·ª©c v√† c∆° ch·∫ø b·∫£o m·∫≠t trong qu√° tr√¨nh c·∫≠p nh·∫≠t firmware
1.2.1 Th√°ch th·ª©c trong b·∫£o m·∫≠t cho FOTA
1.2.2 C√°c c∆° ch·∫ø v√† thu·∫≠t to√°n d√πng trong b·∫£o m·∫≠t cho FOTA

1.3 ƒê·ªÅ xu·∫•t bootloader b·∫£o m·∫≠t cho h·ªá th·ªëng IoT d√πng vi ƒëi·ªÅu khi·ªÉn ARM Cortex
1.3.1 S∆° ƒë·ªì t·ªïng quan gi·∫£i ph√°p.
1.3.2 ·ª®ng d·ª•ng c√°c c∆° ch·∫ø b·∫£o m·∫≠t.
1.3.3 M·ª•c ti√™u thi·∫øt k·∫ø (g·∫Øn v√†o cu·ªëi m·ª•c n√†y nh∆∞ c√¥ y√™u c·∫ßu).

1.4 K·∫øt lu·∫≠n ch∆∞∆°ng

CH∆Ø∆†NG 2. C∆† S·ªû L√ù THUY·∫æT V·ªÄ BOOTLOADER CHO ·ª®NG DUNG FOTA S·ª¨ D·ª§NG C√ÅC THU·∫¨T TO√ÅN B·∫¢O M·∫¨T
2.1. T·ªïng quan v·ªÅ bootloader trong h·ªá th·ªëng nh√∫ng
2.1.1 Vai tr√≤ v√† v·ªã tr√≠ c·ªßa bootloader trong ti·∫øn tr√¨nh kh·ªüi ƒë·ªông
2.1.2 C√°c lo·∫°i bootloader (basic, secure, dual-app, A/B, rollback...)

2.2. Nguy√™n l√Ω c·∫≠p nh·∫≠t firmware t·ª´ xa (FOTA)
2.2.1 Ki·∫øn tr√∫c c∆° b·∫£n FOTA
2.2.2 Y√™u c·∫ßu k·ªπ thu·∫≠t khi tri·ªÉn khai tr√™n thi·∫øt b·ªã nh√∫ng

2.3. C∆° s·ªü l√Ω thuy·∫øt v·ªÅ c√°c thu·∫≠t to√°n b·∫£o m·∫≠t s·ª≠ d·ª•ng trong FOTA
2.3.1 Thu·∫≠t to√°n m√£ h√≥a AES-128
2.3.2 Thu·∫≠t to√°n bƒÉm SHA-256
2.3.3 Ch·ªØ k√Ω s·ªë RSA v√† c∆° ch·∫ø x√°c th·ª±c

2.4. M√¥ h√¨nh ph√¢n v√πng flash v√† c∆° ch·∫ø rollback
2.4.1 Ph√¢n v√πng A/B v√† v√πng metadata
2.4.2 K·ªπ thu·∫≠t kh√¥i ph·ª•c khi c·∫≠p nh·∫≠t th·∫•t b·∫°i

2.5. K·∫øt lu·∫≠n ch∆∞∆°ng

CH∆Ø∆†NG 3. THI·∫æT K·∫æ BOOTLOAER B·∫¢O M·∫¨T CHO ·ª®NG D·ª§NG FOTA TR√äN VI ƒêI·ªÄU KHI·ªÇN ARM CORTEX

3.1. Ph√¢n t√≠ch y√™u c·∫ßu v√† ki·∫øn tr√∫c h·ªá th·ªëng
3.1.1 M·ª•c ti√™u v√† ph·∫°m vi thi·∫øt k·∫ø
3.1.2 Y√™u c·∫ßu ph·∫ßn c·ª©ng: STM32F4, ESP32
3.1.3 H·∫°n ch·∫ø t√†i nguy√™n v√† y√™u c·∫ßu b·∫£o m·∫≠t
3.1.4 S∆° ƒë·ªì t·ªïng th·ªÉ h·ªá th·ªëng: k·∫øt n·ªëi, d·ªØ li·ªáu, ph√¢n vai (PC ‚Üí ESP32 ‚Üí STM32)

3.2. Thi·∫øt k·∫ø h·ªá th·ªëng c·∫≠p nh·∫≠t b·∫£o m·∫≠t
3.2.1 C√¥ng c·ª• m√£ h√≥a firmware: c·∫•u tr√∫c file .bin, metadata, ch·ªØ k√Ω
3.2.2 Quy tr√¨nh c·∫≠p nh·∫≠t t·∫°i STM32:
a. Gi·∫£i m√£ AES
b. Ki·ªÉm tra ch·ªØ k√Ω s·ªë RSA
c. So s√°nh m√£ bƒÉm SHA-256
d. Ghi v√πng flash v√† rollback

3.2.3 S∆° ƒë·ªì b·ªô nh·ªõ v√† quy t·∫Øc kh·ªüi ƒë·ªông v√† Ph√¢n v√πng A/B, metadata, l·ª±a ch·ªçn firmware active

3.3. Giao ti·∫øp v√† giao th·ª©c truy·ªÅn firmware
3.3.1 Giao ti·∫øp UART gi·ªØa ESP32 v√† STM32 v√† Thi·∫øt k·∫ø g√≥i tin truy·ªÅn d·ªØ li·ªáu firmware
3.3.2 Ki·ªÉm tra l·ªói, ki·ªÉm so√°t lu·ªìng, x√°c th·ª±c CRC (n·∫øu c√≥)

3.4. Thi·∫øt k·∫ø ki·ªÉm th·ª≠ v√† ƒë√°nh gi√° h·ªá th·ªëng
3.4.1 K·ªãch b·∫£n ki·ªÉm th·ª≠:
a. ·∫≠p nh·∫≠t h·ª£p l·ªá
b. Sai m√£ hash
c. Sai ch·ªØ k√Ω s·ªë
d. M·∫•t ngu·ªìn gi·ªØa ch·ª´ng
3.4.2 K·∫øt qu·∫£ th·ª±c nghi·ªám:
a. T·ª∑ l·ªá c·∫≠p nh·∫≠t th√†nh c√¥ng
b. Th·ªùi gian x·ª≠ l√Ω (AES, RSA)
c. Dung l∆∞·ª£ng b·ªô nh·ªõ chi·∫øm d·ª•ng
4.3.3 Ph√¢n t√≠ch ∆∞u ƒëi·ªÉm, h·∫°n ch·∫ø v√† t√≠nh kh·∫£ thi

3.5. K·∫øt lu·∫≠n ch∆∞∆°ng


************************************************************************************

\subsubsection{Th·ª±c tr·∫°ng √°p d·ª•ng c·∫≠p nh·∫≠t ph·∫ßn m·ªÅm t·ª´ xa}
Trong nh·ªØng nƒÉm g·∫ßn ƒë√¢y, c·∫≠p nh·∫≠t ph·∫ßn m·ªÅm t·ª´ xa (Firmware Over-The-Air ‚Äì FOTA) ƒë√£ tr·ªü th√†nh m·ªôt nhu c·∫ßu t·∫•t y·∫øu trong v√≤ng ƒë·ªùi ph√°t tri·ªÉn v√† v·∫≠n h√†nh thi·∫øt b·ªã nh√∫ng. Khi thi·∫øt b·ªã ƒë∆∞·ª£c tri·ªÉn khai ph√¢n t√°n ·ªü nhi·ªÅu ƒë·ªãa ƒëi·ªÉm kh√°c nhau ‚Äì ƒë√¥i khi ·ªü nh·ªØng khu v·ª±c kh√¥ng th·ªÉ ti·∫øp c·∫≠n v·∫≠t l√Ω ‚Äì vi·ªác c·∫≠p nh·∫≠t firmware b·∫±ng c√°p ho·∫∑c giao di·ªán tr·ª±c ti·∫øp l√† kh√¥ng th·ª±c t·∫ø. Thay v√†o ƒë√≥, c√°c gi·∫£i ph√°p FOTA gi√∫p gi·∫£m thi·ªÉu chi ph√≠ b·∫£o tr√¨, r√∫t ng·∫Øn th·ªùi gian c·∫≠p nh·∫≠t v√† ƒë·∫£m b·∫£o thi·∫øt b·ªã lu√¥n ƒë∆∞·ª£c v√° l·ªói b·∫£o m·∫≠t k·ªãp th·ªùi.

Theo kh·∫£o s√°t t·ª´ IoT Analytics (2023), c√≥ ƒë·∫øn 74% doanh nghi·ªáp ph√°t tri·ªÉn thi·∫øt b·ªã IoT coi FOTA l√† m·ªôt y√™u c·∫ßu b·∫Øt bu·ªôc trong thi·∫øt k·∫ø h·ªá th·ªëng, ƒë·∫∑c bi·ªát l√† ·ªü c√°c lƒ©nh v·ª±c nh∆∞: thi·∫øt b·ªã ƒëeo y t·∫ø, c·∫£m bi·∫øn n√¥ng nghi·ªáp, c√¥ng t∆° ƒëi·ªán th√¥ng minh, v√† thi·∫øt b·ªã c√¥ng nghi·ªáp. Th·ªã tr∆∞·ªùng ·ª©ng d·ª•ng FOTA kh√¥ng ch·ªâ d·ª´ng ·ªü c√°c thi·∫øt b·ªã IoT ti√™u d√πng m√† c√≤n ƒë∆∞·ª£c m·ªü r·ªông m·∫°nh m·∫Ω trong ng√†nh c√¥ng nghi·ªáp √¥ t√¥, n∆°i c√°c h√£ng nh∆∞ Tesla, Ford, Toyota s·ª≠ d·ª•ng FOTA ƒë·ªÉ c·∫≠p nh·∫≠t h·ªá th·ªëng ƒëi·ªÅu khi·ªÉn ƒë·ªông c∆°, giao di·ªán ng∆∞·ªùi d√πng, v√† c·∫£ ph·∫ßn m·ªÅm li√™n quan ƒë·∫øn an to√†n.

Tr√™n th·ª±c t·∫ø, nhi·ªÅu n·ªÅn t·∫£ng nh√∫ng ph·ªï bi·∫øn ƒë√£ t√≠ch h·ª£p s·∫µn kh·∫£ nƒÉng h·ªó tr·ª£ c·∫≠p nh·∫≠t t·ª´ xa. V√≠ d·ª•, Espressif ESP32 cung c·∫•p OTA API trong b·ªô SDK ESP-IDF, cho ph√©p c·∫≠p nh·∫≠t qua Wi-Fi v·ªõi t√≠nh nƒÉng x√°c minh CRC v√† ph√¢n v√πng A/B. T∆∞∆°ng t·ª±, STM32 h·ªó tr·ª£ bootloader t√πy bi·∫øn v√† giao ti·∫øp UART/USB, cho ph√©p c·∫≠p nh·∫≠t qua ph·∫ßn m·ªÅm trung gian nh∆∞ STM32CubeProgrammer ho·∫∑c custom firmware t·∫£i qua m·∫°ng.

Tuy v·∫≠y, vi·ªác tri·ªÉn khai FOTA trong m√¥i tr∆∞·ªùng nh√∫ng v·∫´n c√≤n g·∫∑p nhi·ªÅu h·∫°n ch·∫ø. M·ªôt s·ªë h·ªá th·ªëng ch·ªâ tri·ªÉn khai c·∫≠p nh·∫≠t c∆° b·∫£n, kh√¥ng c√≥ ki·ªÉm tra ch·ªØ k√Ω s·ªë hay m√£ h√≥a n·ªôi dung, khi·∫øn firmware c√≥ th·ªÉ b·ªã gi·∫£ m·∫°o ho·∫∑c s·ª≠a ƒë·ªïi b·ªüi c√°c cu·ªôc t·∫•n c√¥ng trung gian. Ngo√†i ra, nhi·ªÅu thi·∫øt b·ªã nh√∫ng c√≥ t√†i nguy√™n ph·∫ßn c·ª©ng h·∫°n ch·∫ø (√≠t RAM, flash nh·ªè, kh√¥ng c√≥ b·ªô gia t·ªëc m√£ h√≥a ph·∫ßn c·ª©ng), khi·∫øn cho vi·ªác t√≠ch h·ª£p c√°c thu·∫≠t to√°n b·∫£o m·∫≠t ti√™u chu·∫©n nh∆∞ AES, SHA hay RSA tr·ªü n√™n ph·ª©c t·∫°p.

B√™n c·∫°nh y·∫øu t·ªë k·ªπ thu·∫≠t, m·ªôt s·ªë h·ªá th·ªëng c√≤n b·ªè qua kh·∫£ nƒÉng rollback ‚Äì t·ª©c quay tr·ªü v·ªÅ firmware tr∆∞·ªõc ƒë√≥ n·∫øu c·∫≠p nh·∫≠t m·ªõi th·∫•t b·∫°i. ƒêi·ªÅu n√†y d·∫´n ƒë·∫øn nguy c∆° thi·∫øt b·ªã b·ªã ‚Äúbrick‚Äù ho√†n to√†n n·∫øu firmware m·ªõi b·ªã l·ªói ho·∫∑c qu√° tr√¨nh c·∫≠p nh·∫≠t b·ªã gi√°n ƒëo·∫°n.

T·∫°i Vi·ªát Nam, trong c√°c d·ª± √°n IoT quy m√¥ nh·ªè v√† v·ª´a ‚Äì ch·∫≥ng h·∫°n h·ªá th·ªëng gi√°m s√°t c√¢y tr·ªìng, tr·∫°m quan tr·∫Øc m√¥i tr∆∞·ªùng, ho·∫∑c b·ªô ƒëi·ªÅu khi·ªÉn thi·∫øt b·ªã ƒëi·ªán ‚Äì vi·ªác c·∫≠p nh·∫≠t firmware ch·ªß y·∫øu v·∫´n th·ª±c hi·ªán qua c·ªïng UART th·ªß c√¥ng, ho·∫∑c g·ª≠i file OTA qua giao th·ª©c ƒë∆°n gi·∫£n kh√¥ng m√£ h√≥a. ƒêi·ªÅu n√†y cho th·∫•y ti·ªÅm nƒÉng v√† s·ª± c·∫•p thi·∫øt trong vi·ªác x√¢y d·ª±ng m·ªôt gi·∫£i ph√°p bootloader b·∫£o m·∫≠t, nh·∫π, hi·ªáu qu·∫£, gi√∫p c√°c h·ªá th·ªëng n√†y ti·∫øp c·∫≠n ƒë∆∞·ª£c m√¥ h√¨nh FOTA hi·ªán ƒë·∫°i, an to√†n h∆°n v√† ph√π h·ª£p v·ªõi ph·∫ßn c·ª©ng hi·ªán c√≥.

/////////////////////
\subsection{C√°c th√°ch th·ª©c v√† c∆° ch·∫ø b·∫£o m·∫≠t trong qu√° tr√¨nh c·∫≠p nh·∫≠t firmware}
\subsubsection{Th√°ch th·ª©c trong b·∫£o m·∫≠t cho FOTA}
M·∫∑c d√π FOTA mang l·∫°i nhi·ªÅu l·ª£i √≠ch trong v·∫≠n h√†nh thi·∫øt b·ªã nh√∫ng, qu√° tr√¨nh c·∫≠p nh·∫≠t firmware t·ª´ xa l·∫°i ti·ªÅm ·∫©n nhi·ªÅu r·ªßi ro b·∫£o m·∫≠t nghi√™m tr·ªçng n·∫øu kh√¥ng c√≥ bi·ªán ph√°p b·∫£o v·ªá ph√π h·ª£p.

M·ªôt trong nh·ªØng th√°ch th·ª©c l·ªõn nh·∫•t l√† nguy c∆° firmware b·ªã gi·∫£ m·∫°o ho·∫∑c ch√®n m√£ ƒë·ªôc. Trong tr∆∞·ªùng h·ª£p kh√¥ng c√≥ x√°c th·ª±c ngu·ªìn g·ªëc, thi·∫øt b·ªã c√≥ th·ªÉ v√¥ t√¨nh n·∫°p v√† th·ª±c thi m·ªôt firmware do k·∫ª t·∫•n c√¥ng t·∫°o ra, d·∫´n ƒë·∫øn vi·ªác m·∫•t ki·ªÉm so√°t thi·∫øt b·ªã ho·∫∑c khai th√°c d·ªØ li·ªáu n·ªôi b·ªô. Theo b√°o c√°o c·ªßa Palo Alto Networks (2022), h∆°n 55% l·ªó h·ªïng b·∫£o m·∫≠t IoT c√≥ li√™n quan ƒë·∫øn firmware v√† quy tr√¨nh c·∫≠p nh·∫≠t kh√¥ng an to√†n.

Ngo√†i ra, t√≠nh to√†n v·∫πn d·ªØ li·ªáu c≈©ng l√† m·ªôt ƒëi·ªÉm y·∫øu ph·ªï bi·∫øn. Trong m√¥i tr∆∞·ªùng truy·ªÅn kh√¥ng d√¢y, vi·ªác nhi·ªÖu s√≥ng, m·∫•t g√≥i ho·∫∑c t·∫•n c√¥ng trung gian (Man-in-the-Middle) c√≥ th·ªÉ khi·∫øn firmware b·ªã thay ƒë·ªïi trong qu√° tr√¨nh truy·ªÅn t·∫£i. N·∫øu kh√¥ng ki·ªÉm tra t√≠nh to√†n v·∫πn b·∫±ng thu·∫≠t to√°n bƒÉm nh∆∞ SHA-256, thi·∫øt b·ªã c√≥ th·ªÉ ghi ƒë√® firmware l·ªói l√™n flash v√† kh√¥ng th·ªÉ kh·ªüi ƒë·ªông l·∫°i.

M·ªôt v·∫•n ƒë·ªÅ kh√°c l√† thi·∫øu kh·∫£ nƒÉng ph·ª•c h·ªìi khi c·∫≠p nh·∫≠t th·∫•t b·∫°i. Nhi·ªÅu thi·∫øt b·ªã ch·ªâ s·ª≠ d·ª•ng m·ªôt v√πng flash cho firmware ch√≠nh. N·∫øu qu√° tr√¨nh ghi b·ªã gi√°n ƒëo·∫°n (do m·∫•t ƒëi·ªán, reset), h·ªá th·ªëng c√≥ th·ªÉ b·ªã ‚Äúbrick‚Äù. ƒêi·ªÅu n√†y ƒë·∫∑c bi·ªát nguy hi·ªÉm v·ªõi c√°c thi·∫øt b·ªã tri·ªÉn khai c·ªë ƒë·ªãnh ho·∫∑c kh√¥ng c√≥ giao di·ªán debug.

Cu·ªëi c√πng, r√†o c·∫£n quan tr·ªçng l√† h·∫°n ch·∫ø v·ªÅ t√†i nguy√™n ph·∫ßn c·ª©ng: vi ƒëi·ªÅu khi·ªÉn ph·ªï bi·∫øn nh∆∞ STM32F4 th∆∞·ªùng ch·ªâ c√≥ v√†i trƒÉm KB RAM v√† v√†i MB flash, kh√¥ng ƒë·ªß ƒë·ªÉ l∆∞u firmware t·∫°m, gi·∫£i m√£ AES hay x√°c th·ª±c RSA n·∫øu kh√¥ng ƒë∆∞·ª£c t·ªëi ∆∞u k·ªπ. Do ƒë√≥, gi·∫£i ph√°p b·∫£o m·∫≠t cho FOTA c·∫ßn ƒë∆∞·ª£c thi·∫øt k·∫ø nh·∫π, hi·ªáu qu·∫£, v√† ph√π h·ª£p v·ªõi ƒë·∫∑c ƒëi·ªÉm ph·∫ßn c·ª©ng h·∫°n ch·∫ø.

\subsubsection{C√°c c∆° ch·∫ø v√† thu·∫≠t to√°n d√πng trong b·∫£o m·∫≠t cho FOTA}
ƒê·ªÉ gi·∫£i quy·∫øt c√°c th√°ch th·ª©c n√™u tr√™n, c√°c h·ªá th·ªëng FOTA hi·ªán ƒë·∫°i th∆∞·ªùng t√≠ch h·ª£p ba l·ªõp b·∫£o v·ªá ch√≠nh: b·∫£o m·∫≠t n·ªôi dung, x√°c th·ª±c ngu·ªìn g·ªëc v√† ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn.

    M√£ h√≥a n·ªôi dung (confidentiality): D·ªØ li·ªáu firmware th∆∞·ªùng ƒë∆∞·ª£c m√£ h√≥a tr∆∞·ªõc khi truy·ªÅn ƒëi ƒë·ªÉ tr√°nh b·ªã l·ªô th√¥ng tin. Thu·∫≠t to√°n AES-128 (Advanced Encryption Standard) l√† l·ª±a ch·ªçn ph·ªï bi·∫øn nh·ªù ƒë·ªô an to√†n cao, t·ªëc ƒë·ªô nhanh v√† kh·∫£ nƒÉng tri·ªÉn khai hi·ªáu qu·∫£ tr√™n c√°c vi ƒëi·ªÅu khi·ªÉn ARM Cortex.

    X√°c th·ª±c ngu·ªìn g·ªëc (authenticity): Thi·∫øt b·ªã c·∫ßn x√°c minh r·∫±ng firmware ƒë·∫øn t·ª´ ngu·ªìn h·ª£p l·ªá, th√¥ng qua ch·ªØ k√Ω s·ªë (digital signature) ƒë∆∞·ª£c t·∫°o b·∫±ng kh√≥a ri√™ng v√† ki·ªÉm tra b·∫±ng kh√≥a c√¥ng khai. RSA l√† m·ªôt trong c√°c thu·∫≠t to√°n ph·ªï bi·∫øn cho m·ª•c ƒë√≠ch n√†y.

    Ki·ªÉm tra to√†n v·∫πn (integrity): Tr∆∞·ªõc khi ghi firmware v√†o flash, thi·∫øt b·ªã t√≠nh to√°n l·∫°i m√£ bƒÉm SHA-256 ƒë·ªÉ so s√°nh v·ªõi gi√° tr·ªã hash ban ƒë·∫ßu ƒë∆∞·ª£c k√Ω. N·∫øu kh√¥ng tr√πng kh·ªõp, firmware b·ªã lo·∫°i b·ªè ƒë·ªÉ ƒë·∫£m b·∫£o h·ªá th·ªëng kh√¥ng th·ª±c thi d·ªØ li·ªáu l·ªói.

Ngo√†i ra, vi·ªác ph√¢n chia b·ªô nh·ªõ th√†nh hai ph√¢n v√πng firmware (A/B) gi√∫p h·ªá th·ªëng c√≥ kh·∫£ nƒÉng ph·ª•c h·ªìi trong tr∆∞·ªùng h·ª£p c·∫≠p nh·∫≠t th·∫•t b·∫°i, b·∫±ng c√°ch gi·ªØ l·∫°i b·∫£n firmware ·ªïn ƒë·ªãnh tr∆∞·ªõc ƒë√≥. M·ªôt s·ªë vi ƒëi·ªÅu khi·ªÉn nh∆∞ STM32 c√≤n h·ªó tr·ª£ k·ªπ thu·∫≠t secure boot ƒë·ªÉ x√°c minh firmware ngay t·ª´ qu√° tr√¨nh kh·ªüi ƒë·ªông.

C√°c c∆° ch·∫ø tr√™n c·∫ßn ƒë∆∞·ª£c l·ª±a ch·ªçn v√† tri·ªÉn khai c·∫©n th·∫≠n, ph√π h·ª£p v·ªõi ƒë·∫∑c ƒëi·ªÉm ph·∫ßn c·ª©ng c·ª• th·ªÉ c·ªßa h·ªá th·ªëng ƒë·ªÉ ƒë·∫°t ƒë∆∞·ª£c s·ª± c√¢n b·∫±ng gi·ªØa t√≠nh b·∫£o m·∫≠t v√† hi·ªáu su·∫•t x·ª≠ l√Ω.

////////////
\subsection{ƒê·ªÅ xu·∫•t bootloader b·∫£o m·∫≠t cho h·ªá th·ªëng IoT d√πng vi ƒëi·ªÅu khi·ªÉn ARM Cortex}
\subsubsection{S∆° ƒë·ªì t·ªïng quan gi·∫£i ph√°p}
Gi·∫£i ph√°p ƒë·ªÅ xu·∫•t g·ªìm ba th√†nh ph·∫ßn ch√≠nh:

    Tool m√£ h√≥a tr√™n m√°y t√≠nh (Python):

Ng∆∞·ªùi ph√°t tri·ªÉn ph·∫ßn m·ªÅm s·ª≠ d·ª•ng tool ƒë·ªÉ:

T√≠nh SHA-256 tr√™n firmware g·ªëc.

K√Ω m√£ bƒÉm b·∫±ng kh√≥a ri√™ng RSA.

M√£ h√≥a to√†n b·ªô firmware b·∫±ng AES-128 (ch·∫ø ƒë·ªô CBC).

T·∫°o ra file .bin ƒë√£ m√£ h√≥a + ch·ªØ k√Ω + metadata.

    Gateway trung gian (ESP32):

K·∫øt n·ªëi Internet ho·∫∑c nh·∫≠n firmware t·ª´ m√°y t√≠nh.

G·ª≠i file .bin ƒë√£ m√£ h√≥a qua UART t·ªõi STM32F4.

Kh√¥ng th·ª±c hi·ªán b·∫•t k·ª≥ x·ª≠ l√Ω b·∫£o m·∫≠t n√†o.

    Thi·∫øt b·ªã ch√≠nh (STM32F4):

Nh·∫≠n d·ªØ li·ªáu .bin t·ª´ ESP32.

Gi·∫£i m√£ firmware b·∫±ng AES-128.

T√≠nh l·∫°i m√£ bƒÉm SHA-256 t·ª´ d·ªØ li·ªáu sau gi·∫£i m√£.

Gi·∫£i m√£ ch·ªØ k√Ω s·ªë b·∫±ng RSA (kh√≥a c√¥ng khai l∆∞u trong flash).

So s√°nh m√£ bƒÉm ‚Üí n·∫øu h·ª£p l·ªá, ghi v√†o ph√¢n v√πng inactive.

Sau khi ghi xong, c·∫≠p nh·∫≠t metadata v√† chuy·ªÉn boot sang v√πng firmware m·ªõi.

S∆° ƒë·ªì minh h·ªça t·ªïng quan c√≥ th·ªÉ ƒë∆∞·ª£c tr√¨nh b√†y trong H√¨nh 1.3.1 (Gateway ‚Üí STM32 ‚Üí x√°c th·ª±c ‚Üí ghi flash).

\subsubsection{·ª®ng d·ª•ng c√°c c∆° ch·∫ø b·∫£o m·∫≠t}
T·∫•t c·∫£ quy tr√¨nh b·∫£o m·∫≠t ƒë∆∞·ª£c th·ª±c hi·ªán t·∫°i thi·∫øt b·ªã ƒë√≠ch (STM32F4):

Gi·∫£i m√£ AES-128: d·ªØ li·ªáu firmware ƒë∆∞·ª£c m√£ h√≥a b·∫±ng AES (CBC mode) t·∫°i tool ph√°t h√†nh. STM32 s·ª≠ d·ª•ng kh√≥a AES c·ªë ƒë·ªãnh ƒë·ªÉ gi·∫£i m√£.

Ki·ªÉm tra t√≠nh to√†n v·∫πn: sau gi·∫£i m√£, STM32 t√≠nh l·∫°i SHA-256 v√† so s√°nh v·ªõi m√£ bƒÉm ƒë√£ k√Ω ƒë∆∞·ª£c g·ª≠i k√®m.

X√°c th·ª±c ngu·ªìn g·ªëc: ch·ªØ k√Ω s·ªë RSA tr√™n m√£ bƒÉm ban ƒë·∫ßu ƒë∆∞·ª£c ki·ªÉm tra b·∫±ng kh√≥a c√¥ng khai RSA ƒë√£ l∆∞u trong flash c·ªßa STM32.

Ghi flash v√† boot: sau x√°c th·ª±c, firmware ƒë∆∞·ª£c ghi v√†o ph√¢n v√πng kh√¥ng ho·∫°t ƒë·ªông (A ho·∫∑c B). N·∫øu qu√° tr√¨nh c·∫≠p nh·∫≠t th√†nh c√¥ng, metadata ƒë∆∞·ª£c c·∫≠p nh·∫≠t v√† bootloader s·∫Ω chuy·ªÉn sang v√πng firmware m·ªõi.

Vi·ªác ph√¢n t√°ch r√µ r√†ng gi·ªØa c√°c th√†nh ph·∫ßn gi√∫p h·ªá th·ªëng v·ª´a linh ho·∫°t v·ª´a b·∫£o m·∫≠t, ƒë·ªìng th·ªùi ph√π h·ª£p v·ªõi t√†i nguy√™n h·∫°n ch·∫ø c·ªßa vi ƒëi·ªÅu khi·ªÉn.

\subsubsection{M·ª•c ti√™u thi·∫øt k·∫ø}
Gi·∫£i ph√°p bootloader b·∫£o m·∫≠t ƒë∆∞·ª£c x√¢y d·ª±ng nh·∫±m ƒë·∫°t c√°c m·ª•c ti√™u sau:

T√≠nh b·∫£o m·∫≠t:

Ch·ªâ ch·∫•p nh·∫≠n firmware h·ª£p l·ªá, ƒë∆∞·ª£c k√Ω s·ªë v√† m√£ h√≥a ƒë√∫ng ƒë·ªãnh d·∫°ng.

B·∫£o v·ªá n·ªôi dung firmware trong qu√° tr√¨nh truy·ªÅn t·∫£i.

Ph√°t hi·ªán s·ª≠a ƒë·ªïi ho·∫∑c gi·∫£ m·∫°o firmware.

Kh·∫£ nƒÉng ph·ª•c h·ªìi v√† an to√†n c·∫≠p nh·∫≠t:

Ph√¢n v√πng A/B, cho ph√©p rollback khi c·∫≠p nh·∫≠t th·∫•t b·∫°i.

Bootloader ƒë·ªôc l·∫≠p, ch·ªëng ghi ƒë√®.

T·ªëi ∆∞u t√†i nguy√™n h·ªá th·ªëng:

T·∫≠n d·ª•ng th∆∞ vi·ªán m√£ h√≥a nh·∫π (AES, SHA-256, RSA).

Dung l∆∞·ª£ng bootloader nh·ªè (< 32KB), ph√π h·ª£p v·ªõi STM32F4.

Kh√¥ng y√™u c·∫ßu ph·∫ßn c·ª©ng h·ªó tr·ª£ m√£ h√≥a (d√πng ph·∫ßn m·ªÅm thu·∫ßn C).

T√≠nh kh·∫£ thi v√† th·ª±c ti·ªÖn:

C√≥ th·ªÉ √°p d·ª•ng trong s·∫£n ph·∫©m th∆∞∆°ng m·∫°i.

Ph√π h·ª£p v·ªõi c√°c thi·∫øt b·ªã IoT quy m√¥ v·ª´a v√† nh·ªè ·ªü Vi·ªát Nam.

D·ªÖ t√≠ch h·ª£p v·ªõi quy tr√¨nh ph√°t h√†nh ph·∫ßn m·ªÅm hi·ªán c√≥ (tool Python ƒë∆°n gi·∫£n).

üìö T√†i li·ªáu tham kh·∫£o:
STMicroelectronics ‚Äì AN4992 ‚Äì STM32 microcontroller system security overview
‚Üí H∆∞·ªõng d·∫´n t·ªïng th·ªÉ v·ªÅ secure boot, flash layout, b·∫£o m·∫≠t AES/RSA tr√™n STM32.
https://www.st.com/resource/en/application_note/an4992-stm32-microcontroller-system-security-overview-stmicroelectronics.pdf

NIST FIPS 197 ‚Äì Advanced Encryption Standard (AES)
‚Üí Ti√™u chu·∫©n thu·∫≠t to√°n m√£ h√≥a AES, d√πng trong quy tr√¨nh b·∫£o m·∫≠t.
https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.197.pdf

////////////////////////
\subsection{K·∫øt lu·∫≠n ch∆∞∆°ng}
Ch∆∞∆°ng 1 ƒë√£ tr√¨nh b√†y t·ªïng quan v·ªÅ h·ªá th·ªëng nh√∫ng, thi·∫øt b·ªã IoT v√† t·∫ßm quan tr·ªçng c·ªßa vi·ªác c·∫≠p nh·∫≠t ph·∫ßn m·ªÅm t·ª´ xa (FOTA) trong b·ªëi c·∫£nh thi·∫øt b·ªã ƒë∆∞·ª£c tri·ªÉn khai ph√¢n t√°n r·ªông r√£i. C√°c th√°ch th·ª©c v·ªÅ b·∫£o m·∫≠t nh∆∞ firmware gi·∫£ m·∫°o, m·∫•t t√≠nh to√†n v·∫πn d·ªØ li·ªáu v√† c·∫≠p nh·∫≠t l·ªói ƒë√£ ƒë∆∞·ª£c ph√¢n t√≠ch, cho th·∫•y s·ª± c·∫ßn thi·∫øt ph·∫£i t√≠ch h·ª£p c√°c c∆° ch·∫ø b·∫£o m·∫≠t trong qu√° tr√¨nh c·∫≠p nh·∫≠t.

T·ª´ ƒë√≥, ƒë·ªÅ t√†i ƒë√£ ƒë·ªÅ xu·∫•t m·ªôt gi·∫£i ph√°p bootloader b·∫£o m·∫≠t d√†nh cho d√≤ng vi ƒëi·ªÅu khi·ªÉn ARM Cortex, v·ªõi s·ª± t√°ch bi·ªát r√µ r√†ng gi·ªØa ba th√†nh ph·∫ßn: c√¥ng c·ª• m√£ h√≥a ph√°t h√†nh firmware, gateway trung gian v√† thi·∫øt b·ªã ƒë√≠ch (STM32F4). To√†n b·ªô qu√° tr√¨nh x√°c th·ª±c, gi·∫£i m√£ v√† ghi flash ƒë∆∞·ª£c th·ª±c hi·ªán tr·ª±c ti·∫øp t·∫°i bootloader, gi√∫p ƒë·∫£m b·∫£o an to√†n trong m√¥i tr∆∞·ªùng kh√¥ng ƒë√°ng tin c·∫≠y, ƒë·ªìng th·ªùi ph√π h·ª£p v·ªõi t√†i nguy√™n h·∫°n ch·∫ø c·ªßa h·ªá th·ªëng nh√∫ng.

Ph·∫ßn ti·∫øp theo (Ch∆∞∆°ng 2) s·∫Ω tr√¨nh b√†y c∆° s·ªü l√Ω thuy·∫øt li√™n quan ƒë·∫øn c√°c th√†nh ph·∫ßn k·ªπ thu·∫≠t trong gi·∫£i ph√°p, bao g·ªìm ki·∫øn tr√∫c bootloader, c√°c thu·∫≠t to√°n m√£ h√≥a/bƒÉm/x√°c th·ª±c, c≈©ng nh∆∞ t·ªï ch·ª©c b·ªô nh·ªõ v√† lu·ªìng c·∫≠p nh·∫≠t firmware an to√†n.


*********************************************************************************
